<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Memo</title>
    
    
    <meta content="Memo" name="keywords">
    
    <meta content="Memo - Table Concept 模型剪枝（Model Pruning）是一种模型压缩方法，
对深度神经网络的稠密连接引入稀疏性，
通过将“不重要”的权值直接置零 =&gt; 来减少非零权值数量
最近比较流行基于幅度的权值剪枝方法【4】，该方法将权值取绝对值，
与设定的 threshhold 值进行比较，低于门限的权值被置零。
基于幅度的权值剪枝算法计算高效，可以应用到大部分模型和数据集。
TensorFlow 也使用了基于幅度的权值剪枝算法
模型训练时剪枝，只需选定需要剪枝的层，对于选中做剪枝的层增加一个二进制掩模（mask）变量，
形状和该层的权值张量形状完全相同。该掩模决定了哪些权值参与前向计算。
掩模更新算法则需要为 TensorFlow 训练计算图注入特殊运算符，对当前层权值按绝对值大小排序，
对幅度小于一定门限的权值将其对应掩模值设为 0。
反向传播梯度也经过掩模，被屏蔽的权值（mask 为 0）在反向传播步骤中无法获得更新量
因為有些weight變成0了,所以會再用一個稀疏矩陣index來存對應的位置 TensorFlow 代码目录 tensorflow/contrib/model_pruning/ 提供了对 TensorFlow 框架的扩展，
=&gt;可在模型训练时实现剪枝。
Concept 2 剪枝就是利用某一个准则对某一组或某一个权值置0
从而达到将网络神经元置0以达到稀疏化网络连接从
而加快整个推理过程及缩小模型大小的迭代过程，这个准则有暴力穷尽组合排忧、
使用对角 Hessian 逼近计算每个权值的重要性、基于一阶泰勒展开的模型代价函数来对权值排序、
基于L1绝对值的权值参数大小进行排序、基于在小验证集上的影响进行分值分配排序等方法，
而某一组或某一个网络权值则可以是整个卷积核、全连接层、卷积核或全连接层上的某个权重参数，
剪枝的目的是将冗余的神经元参数置0减小模型大小(需要特殊的模型存储方式)
减少计算参数（需要某种特殊的硬件计算方式）
稀疏化网络连接加快推理速度，剪枝前后的网络连接对比图如下
Implementation 对每个被选中做剪枝的层增加一个二进制掩模（mask）变量，
形状和该层的权值张量形状完全相同。该掩模决定了哪些权值参与前向计算。
掩模更新算法则需要为 TensorFlow 训练计算图注入特殊运算符，
对当前层权值按绝对值大小排序，对幅度小于一定门限的权值将其对应掩模值设为 0。
反向传播梯度也经过掩模，被屏蔽的权值（mask 为 0）在反向传播步骤中无法获得更新量。
研究发现稀疏度不宜从一开始就设置最大，这样容易将重要的权值剪掉造成无法挽回的准确率损失，
更好的方法是渐进稀疏度，从初始稀疏度 （一般为 0 ）开始，逐步增大到最终稀疏度 ，
这期间二进制掩模变量 mask 经历了 n 次更新，每次更新时的门限由当时的稀疏度决定，稀疏度由如下公式计算得到
初始时刻，稀疏度提升较快，而越到后面，稀疏度提升速度会逐渐放缓，
这个比较符合直觉，因为初始时有大量冗余的权值，而越到后面保留的权值数量越少，" name="description">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    

    

    

    
    
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>
    

    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/self/css/default.css">
    <script async src="/layui/layui.js"></script>

    <link rel="stylesheet" async href="/self/css/markdown.min.css">
    <link rel="stylesheet" async href="/self/css/gallery.css">
    
    
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <script async src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js" integrity="sha256-h2tMEmhemR2IN4wbbdNjj9LaDIjzwk2hralQwfJmBOE=" crossorigin="anonymous"></script></head>

<body>
    
    <header class="layui-header layui-bg-cyan">

    
    
    <a class="nav-self-logo" href="/">
        Memo
    </a>

    <ul class="layui-nav layui-layout-right layui-bg-cyan" lay-filter="">
        
        
        <li class="layui-nav-item" id="nav_big"><a href="/post/">Posts</a></li>
        

        
            
                <li class="layui-nav-item" id="nav_big"><a href="/about/">About</a></li>
            
        

        
        <li class="layui-nav-item" id="nav_small">
            <a href="javascript:;">
                <i class="layui-icon layui-icon-app" style="font-size: 24px;"></i>
            </a>

            <dl class="layui-nav-child">
                
                <dd><a href="/post/">Posts</a></dd>
                

                
                    
                        <dd><a href="/about/">About</a></dd>
                    
                
            </dl>
        </li>
    </ul>
</header>

<script>
layui.use('element', function(){
  var element = layui.element;
});
</script>
        <div id="content" style="min-height:80%">
<div class="layui-container" style="margin-bottom: 10px">
    

    <div class="layui-row layui-col-space10">
        <div class="layui-col-md12 layui-col-sm12 layui-col-xs12">
            <div class="layui-card single-card">
                <br />
                <blockquote class="self-elem-quote self-elem-quote-bg-red markdown-body single-title" >
                    <h1></h1>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>0001-01-01</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/tool-pruning/">
            <span class="layui-badge layui-bg-orange" style="vertical-align: 2px;">TOOL-Pruning</span>
        </a>
    

    
    
    
</h3>
                </blockquote>
                <div class="layui-card-body markdown-body single-content">
                    <h1 id="table">Table</h1>
<!-- raw HTML omitted -->
<h1 id="concept">Concept</h1>
<p>模型剪枝（Model Pruning）是一种模型压缩方法，<br>
对深度神经网络的稠密连接引入稀疏性，<br>
通过将“不重要”的权值直接置零 =&gt; 来减少非零权值数量</p>
<p>最近比较流行基于幅度的权值剪枝方法【4】，该方法将权值取绝对值，<br>
与设定的 threshhold 值进行比较，低于门限的权值被置零。<br>
基于幅度的权值剪枝算法计算高效，可以应用到大部分模型和数据集。<br>
TensorFlow 也使用了基于幅度的权值剪枝算法</p>
<p>模型训练时剪枝，只需选定需要剪枝的层，对于选中做剪枝的层增加一个二进制掩模（mask）变量，<br>
形状和该层的权值张量形状完全相同。该掩模决定了哪些权值参与前向计算。<br>
掩模更新算法则需要为 TensorFlow 训练计算图注入特殊运算符，对当前层权值按绝对值大小排序，<br>
对幅度小于一定门限的权值将其对应掩模值设为 0。<br>
反向传播梯度也经过掩模，被屏蔽的权值（mask 为 0）在反向传播步骤中无法获得更新量<br>
因為有些weight變成0了,所以會再用一個稀疏矩陣index來存對應的位置   <br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_012.png" alt="image"></p>
<p>TensorFlow 代码目录 tensorflow/contrib/model_pruning/ 提供了对 TensorFlow  框架的扩展，<br>
=&gt;可在模型训练时实现剪枝。</p>
<h1 id="concept-2">Concept 2</h1>
<p>剪枝就是利用某一个准则对某一组或某一个权值置0<br>
从而达到将网络神经元置0以达到稀疏化网络连接从<br>
而加快整个推理过程及缩小模型大小的迭代过程，这个准则有暴力穷尽组合排忧、<br>
使用对角 Hessian 逼近计算每个权值的重要性、基于一阶泰勒展开的模型代价函数来对权值排序、<br>
基于L1绝对值的权值参数大小进行排序、基于在小验证集上的影响进行分值分配排序等方法，<br>
而某一组或某一个网络权值则可以是整个卷积核、全连接层、卷积核或全连接层上的某个权重参数，<br>
剪枝的目的是将冗余的神经元参数置0减小模型大小(需要特殊的模型存储方式)<br>
减少计算参数（需要某种特殊的硬件计算方式）<br>
稀疏化网络连接加快推理速度，剪枝前后的网络连接对比图如下<br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_007.png" alt="image"></p>
<h1 id="implementation">Implementation</h1>
<p>对每个被选中做剪枝的层增加一个二进制掩模（mask）变量，<br>
形状和该层的权值张量形状完全相同。该掩模决定了哪些权值参与前向计算。<br>
掩模更新算法则需要为 TensorFlow 训练计算图注入特殊运算符，<br>
对当前层权值按绝对值大小排序，对幅度小于一定门限的权值将其对应掩模值设为 0。<br>
反向传播梯度也经过掩模，被屏蔽的权值（mask 为 0）在反向传播步骤中无法获得更新量。</p>
<p>研究发现稀疏度不宜从一开始就设置最大，这样容易将重要的权值剪掉造成无法挽回的准确率损失，<br>
更好的方法是渐进稀疏度，从初始稀疏度 （一般为 0 ）开始，逐步增大到最终稀疏度 ，<br>
这期间二进制掩模变量 mask 经历了 n 次更新，每次更新时的门限由当时的稀疏度决定，稀疏度由如下公式计算得到</p>
<p><img src="https://github.com/evansin100/Pruning-/blob/master/Selection_001.png" alt="image"></p>
<p>初始时刻，稀疏度提升较快，而越到后面，稀疏度提升速度会逐渐放缓，<br>
这个比较符合直觉，因为初始时有大量冗余的权值，而越到后面保留的权值数量越少，<br>
不能再“大刀阔斧”地修剪，而需要更谨慎些，避免“误伤无辜” <br>
=&gt; 所以稀疏代表是要多少範圍要被設定為0<br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_002.png" alt="image"><br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_003.png" alt="image"><br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_004.png" alt="image"><br>
<img src="https://github.com/evansin100/Pruning-/blob/master/Selection_008.png" alt="image"></p>
</div>
            </div>
        </div>

        
    </div>
</div>


        </div><footer>
    

    <div class="layui-container">
        <div class="layui-row">
            <div class="layui-col-md4 layui-col-sm6 layui-col-xs6">
                <h3> Related Sites </h3>
            </div>
        </div>
        <div class="layui-row">
            
            <div class="layui-col-md4 layui-col-sm6 layui-col-xs12">
                <a href="/"><p class="footer-url">home</p></a>
            </div>
            
            <div class="layui-col-md4 layui-col-sm6 layui-col-xs12">
                <a href="/about/"><p class="footer-url">About</p></a>
            </div>
            
        </div>
    </div>
    
    
    <div class="layui-container">
        <p class="copyright">&copy; All rights reserved. Powered by <a href='https://gohugo.io' style='color:#FFFFFF'>Hugo</a> and <a href='https://github.com/ertuil/erblog' style='color:#FFFFFF'>Erblog</a>.</p>
    </div>
</footer>
</body>
</html>
